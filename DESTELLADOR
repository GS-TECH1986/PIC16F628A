#include <16F628A.H> 
#fuses XT,NOWDT,PUT,NOBROWNOUT,NOLVP 
#use delay(clock=4000000) 
#use i2c(master, scl=PIN_A2, sda=PIN_A3) 

#include <flex_lcd.c> 

//----------------------------------- 
#define MCP3021_READ_ADDR 0b10011011 

int16 read_mcp3021(void) 
{ 
int8 lsb; 
int8 msb; 
int16 retval; 

i2c_start(); 
i2c_write(MCP3021_READ_ADDR);    
msb = i2c_read(); 
lsb = i2c_read(0); 
i2c_stop(); 

retval = make16(msb, lsb) >> 2; 

return(retval); 
} 


//============================ 
void main() 
{ 
int16 result; 

lcd_init(); 

while(1) 
  { 
   result = read_mcp3021(); 
   printf(lcd_putc, "\f%lx    ", result); 
   delay_ms(500); 
  } 
}
